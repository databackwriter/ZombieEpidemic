---
title: "Zombie Apocalypse in R - Pete Moore"
author: "Pete Moore - STUDENT ID: 170000983 - COURSE: AC52050 PROGRAMMING LANGUAGES"
date: "11/06/2018"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r tidyup, echo=FALSE}
#keep R tidy
rm(list=ls()) #clear variables
cat("\014")  #clear console
```
## Understanding
This is a study of epidemiology. The basis of the study is to model the interactions between zombies and humans. The interatction between humans and zombies has previously been modelled mathematically by the below ordinary differential equations (ODE's), known as the SRZ Model[^1]:

S′ <- Π−βSZ−δS
```{r eval=FALSE, echo = FALSE}
Srate <- P - B*Si*Zi - d*Si
```
Z′ <- βSZ+ζR−αSZ
```{r eval=FALSE, echo = FALSE}
Zrate <- B*Si*Zi + G*Ri - A*Si*Zi
```
R′ <- δS+αSZ−ζR
```{r eval=FALSE, echo = FALSE}
Rrate <- d*Si + A*Si*Zi - G*Ri
```
Where the following variables are used:
Π - birth rate
δ - natural death rate 
β - transmission rate
ζ - resurrection rate
α - zombie destruction rate
And ′ signifies rate of change (e.g. S′ = dS/dt)
```{r eval=FALSE, echo=FALSE}
# NB anglicised versions of names used
P <- 0 # birth rate
d <- 0.00001 #natural death rate percent per day
B <- 0.0095 #transmission percent per day
G <- 0.0001 #resurrect percent per day
A <- 0.0001 #destroy percent per day
```
Solving these equations using the code in Appendix One [^2], produces the below curve:
image:![](/Users/petermoore/Documents/GitHub/ZombieEpidemic/ODESolutionPython.png)

##### Figure 1: Zombie conquest with (P=0,d=0.0001,B=0.0095,G=0.0001,A=0.0001)[^3]

This shows that even with nominal death and transmission rates, the zombies win.

However this only tells half of the story because the SRZ model does not allow for zombies or humans to be attributed a velocity. At this point the ODE's cannot be solved.

### Goal
The goal of this project is to introduce velocity to the SRZ model and, via a series of Monte Carlo Simulations (MCS); see how Zombies and humans interact in a multitude of scenarios.


### Definitions
The following definitions form the essential components of the model. (Where subsequent definitions are made they will appear in **bold typeface**)

- Humanoid: a human or a zombie
- Susceptible: an uninfected Humanoid 
- Zombification: a Susceptible Humanoid that is turned into a zombie
- Death: a Susceptible Humanoid who dies naturally
- Destruction: a zombie destroyed by a Humanoid
- Removed: a dead human, a destroyed zombie 
- Resurrection: a Removed Humanoid that is turned into a zombie 
- Species: a human or a zombie


## Exploratory Data Analysis

The original SRZ model allows a solution because the equations are in balance, that is Susceptibles are added to by births and reduced by death and zombification, Zombies are added to by Zombification and Resurrection but depleted by Destruction. Finally, the Removed class are added to by Zombification and Death but reduced by resurrections. 

All of these principles may be preserved for the MCS model, however, additional questions need to be asked about the ways in which Humanoids move. For example, what is the average speed of a Humanoid? How does it deviate from the mean? Is this normally distributed? Are the populations geographically distinct? Is the geography bounded?

To answer these the following assumptions were made:

### Initial assumptions
- Different Species of Humanoids begin at geographically distinct locations
- Humanoids act as point particles. That is they may become arbitrarily near to one another (this allows the initial populations to start at the same grid co-ordinate per species)
- Humanoids move in **footsteps**, with one footstep taking place in one unit of time (or **timestep**)
- A **footpath** constitutes a set of footsteps over a series of time series, footpaths must be contiguous (i.e. no levitating!)
- The footstep lengths are normally distrubuted and share the same mean and standard deviation per Species (the **normal distribution assumption**)
- **Since each footstep length is mapped *per unit time* the mean footstep length is the same as a mean velocity**
- When Humanoids of different Species get within a certain critical distance of one another there is a consequence (a human gets zombified, a zombie gets destroyed). This is the **consequences assumption**.
- This is a zero-sum game: a human gets Zombified or a zombie gets destroyed. This is the **zero-sum assumption**.
- This **critical distance** is the same for both species
- Only two Humanoids can interact at any point in time (i.e. a zombie cannot kill two humans in a single timestep)
- Humanoids only have eyes for the nearest victim 
- Zombies beat humans at the **Zombie Win Rate** a number between 0 and 1[^4]
- Newborns move instantly as per the speed of the herd (e.g. they are carried)
```{r intialconditions, echo=FALSE}
#####global constants
prefix.Susceptible<-"Susceptible"
prefix.Zombie<-"Zombie"
prefix.Removed<-"Removed"
prefix.Newborn<-"ProtoLiving"
prefix.Resurrected<-"BackFromDead"
prime.SusceptibleWins<-3
prime.ZombieWins<-2
prime.Resurrection<-5
prime.NaturalDeath<-7
#global (time) parameters
time.ntimesteps<-999  #time steps
time.vtimesteps<-c(0:time.ntimesteps) #set up a zero-based vector, t, that will represent time, NB unit time in steps of one
# epidemiology parameters (note that these have been anglicised from Munz et al, e.g. Π is represented as P)
config.model<-configuration.SRZModel(P=0,d=0.0001,B=0.0095,G=0.0001,a=0.0001,rcritical=1,zombiewinratio=0.95)
config.Zombie<-configuration.Humanoid(xinit= 0,yinit=0,n=2,mu=0,sigma=1)# Zombie configuration
config.Susceptible<-configuration.Humanoid(xinit=10,yinit=10,n=500,mu=0,sigma=1)# Susceptible configuration
config.plot<-config.plot.global()#axes configuration for gif
```
## Data model
As Humanoids take footsteps they tread out a footpath as defined by the average footstep length and the timestep. An average velocity (footstep length) of zero combined with the normal distribution assumption, means that Humanoids  exhibit Brownian motion as modelled. By adapting code for a single particle[^5], random walks in one- and two-dimensions were created as can be seen in appendices two[^6] and three respectively.

The analogy wiht brownian motion is non-trivial. A the heart of the Brownian motion algorithm is a normal distribution. The humanoids movements are therefore centred around a mean and standard deviation and these have real world meainings.  Namely, the standard deviation represents the footstep length of the Humanoid and the mean the direction of motion in a two-dimensional plane.  Together they may be referenced as a drift velocity.

The "brownian motion code"[^7], then, allows the depiction of a Humanoid and its velocity. By embellishing this with an initial position in the x-y plane it is possible to separate the two populations in space, by iteratively calling the algorithm the Humanoids can move in space and time.[^8]

The below animation[^9] visualises the net effect for one iteration of the algorithm.  The Zombies (bottom left) walk randomly as do the humans in the top left. Since the mean is set to zero the random walk leads to each Humanoid drifting to the square root of t (for timestep t)[^10].  Since the direction of this is random, this leads to the two populations interacting. As soon as they are within a **critical distance** of one another the **consequences assumption** means that soemting will happend and the **zero-sum assumption** means this is bad news for one of the Humanoids. The animation shows the humans (red) being attacked and turning into zombies. And vice-versa (although this is rare because we have set a high **Zombie Win Rate**).  Every so often we see a Resurrection occur (green), a natural human death (black) or a natural birth (pink).

image:![](/Users/petermoore/Documents/GitHub/ZombieEpidemic/zombieanimationillustrative.gif)
##### Figure 2: Zombie conquest with (P=0.001,d=0.001,G=0.0001,rcritical=1,zombiewinratio=0.95)

### Comparison to Munz et al
Where the code in figure 1 may be presented as absolute, here we have a stochastic model and therefore need to run several iterations. In the first instance, the model was executed with many 





## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

## Evaluation
The initial phase of work was concentrated on producing the zombie animation. This felt like a good approach because it allowed one to get a "feel" of the interaction between Humanoids. Observing the zombies in this way allowed the initial assumptions to be questioned: for example, it was easy to see that the average of the distribution did indeed equate to a velocity; on the other hand, the idea that the speeds of Humanoids were normally distributed was challenged. The group of humans in particular just *looked* wrong as the "weakest of the herd" were just the unluckiest. With more time the model would have been tweaked to account for this because, as is, the model effectively ignores age and genetics! I think that in reality humans would run away more quickly and this would need revisiting.

One (late discovered) limitation of the model was that there always needed to be at least two zombies (nz=2). This wasn't deemed too much of an impediment because any models with zero zombies would either wait for a resurrection to happen (nz=1!) or be benign. This left nz=2 as an outstanding issue, in this particular modelling style, this was not too problematic because of the reliance on the initial ratios of Zombies:Susceptibles rather than an absolute number (although this did lead to more iterations!).

I would like to have played around with the concept of interface distance because having it the same for both species would seem incorrect. In truth humans are more capable of acting at a greater distance (for example with stones, arrows, guns) so again this would need revisiting.

## References
Munz, P. et al. (2009) ‘Zombies!’, Science.
## Appendix Zero: Coding Environment
The model was built using R-base version 3.4.r ran on RStudio 1.1.432 launched from Anaconda Navigator 1.8.7.  
The following named additional libraries were used: matrixStats, animation, pdist for the purposes of: linear algebra, building the gif file, and calculating the euclidean distance between two matrices respectively.
For the buildig of the OLAP cube SQL Server 2017 was used with SQL Server Management Studio v17.6 and SQL Server Analysis Services 2017 run from Visual Studio 2015.
Where R code was ran form SQL it was done as an external script; these external scripts were built in RStudio originally and where they appear herein do not need reading.
## Appendix One: Original Python ODE Script
##### zombie apocalypse modeling
##### from http://scipy-cookbook.readthedocs.io/items/Zombie_Apocalypse_ODEINT.html

import numpy as np
import matplotlib.pyplot as plt
from scipy.integrate import odeint
plt.ion()
plt.rcParams['figure.figsize'] = 10, 8

P = 0 # birth rate
d = 0.0001 # natural death percent (per day)
B = 0.0095 # transmission percent (per day)
G = 0.0001 # resurect percent (per day)
A = 0.0001 # destroy percent (per day)

##### solve the system dy/dt = f(y, t)
def f(y, t):
 Si = y[0]
 Zi = y[1]
 Ri = y[2]
 # the model equations (see Munz et al. 2009)
 dSdt = P - B*Si*Zi - d*Si
 dZdt = B*Si*Zi + G*Ri - A*Si*Zi
 dRdt = d*Si + A*Si*Zi - G*Ri
 return [dSdt, dZdt, dRdt]

##### initial conditions
S0 = 500. # initial population
Z0 = 0 # initial zombie population
R0 = 0 # initial death population
y0 = [S0, Z0, R0] # initial condition vector
t = np.linspace(0, 5., 1000) # time grid

##### solve the DEs
soln = odeint(f, y0, t)
S = soln[:, 0]
Z = soln[:, 1]
R = soln[:, 2]

##### plot results
plt.figure()

plt.plot(t, S, label='Living')
plt.plot(t, Z, label='Zombies')
plt.xlabel('Days from outbreak')
plt.ylabel('Population')
plt.title('Zombie Apocalypse - No Init. Dead Pop.; No New Births.')
plt.legend(loc=0)

## Appendix Two: Random walk in one dimension
``` {r echo = FALSE}
print(rwalk1dhumanoids)
```
## Appendix Three: Random walk in two dimensions
``` {r echo = FALSE}
print(rwalk2dhumanoids)
```
[^1]: Munz, P. et al. (2009) ‘Zombies!’, Science.
[^2]: Original code as provided in assignment and avaialable at http://scipy-cookbook.readthedocs.io/items/Zombie_Apocalypse_ODEINT.html
[^3]: Using Anglicised equivalents to Greek letters (e.g. P=Π)
[^4]: A corollary to this is that the transmission rates and destruction rates are independent 
[^5]: This code is not identical but was inspired by the example here: http://www.phytools.org/eqg/Exercise_4.1/
[^6]: All code samples can be found inline with the text in the attached Rmarkdown project
[^7]: The function rwalk1dhumanoids
[^8]: A note on space and time in this model: since all incremental steps are relative to one another, this means that, just like the Ordnance Survey, we never have to specify a unit of time or space. This however would be challenged were we to bring the real world into it, for example by including latency of infection, or arrival of weaponry.
[^9]: The animation is also provided as a gif in the attached documentation and I will cry if you don't watch it.
[^10]: TODO Find reference
